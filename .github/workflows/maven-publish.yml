
#https://github.com/msusdev/end-to-end-github-actions/blob/main/presentations/ci_github_actions.md

name: Build Next.js web application
on: push
jobs:
build-project:
  name: Build Project
  runs-on: ubuntu-latest
  steps:
  - name: Checkout code
    uses: actions/checkout@v4
  - name: build mvn
    run: mvn clean
  - name: Build project assets
    run: mvn install
  - name: stagin
    run: mkdir staging && cp target/*.jar staging
  - name: packaging
    uses: actions/upload-artifact@v4
      with:
        name: MaoPass
        path: ./staging/
 

release-project:
  name: Release Project
  runs-on: ubuntu-latest
  needs: build-project
  steps: 
  - name: Download site content
  uses: actions/download-artifact@v4
  with:
    name: MaoPass
  - name: View content
  run: ls -R
  - name: Create GitHub release
  id: create-new-release
  uses: actions/create-release@v4
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  with:
    tag_name: ${{ github.run_number }}
    release_name: Release ${{ github.run_number }}
  - name: Archive site content
    uses: thedoctor0/zip-release@master
    with:
      filename: site.zip
  - name: Upload release asset
    uses: actions/upload-release-asset@v4
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    with:
      upload_url: ${{ steps.create-new-release.outputs.upload_url }}
      asset_path: ./site.zip
      asset_name: site-v${{ github.run_number }}.zip
      asset_content_type: application/zip
